<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>WEB HOOD — your space online</title>
<link href="https://fonts.googleapis.com/css2?family=Bebas+Neue&family=DM+Sans:ital,wght@0,300;0,400;0,500;1,300&family=JetBrains+Mono:wght@400;500&family=Playfair+Display:wght@400;700&family=Space+Grotesk:wght@400;500&family=Raleway:wght@300;400&family=Courier+Prime:wght@400;700&family=Unbounded:wght@400;700&family=Caveat:wght@400;600&display=swap" rel="stylesheet">
<link rel="stylesheet" href="css/style.css">
<!-- Модуль app.js загружает все остальные файлы через import -->
<script type="module" src="js/app.js"></script>
</head>
<body>

<nav class="nav" id="nav">
  <div class="nav-logo" onclick="handleLogoClick(event)">HOOD</div>
  <div class="nav-tagline">web hood</div>
  <div class="nav-actions" id="navActions">
    <button class="btn btn-ghost" onclick="openModal('loginModal')">войти</button>
    <button class="btn btn-accent" onclick="openModal('registerModal')">создать профиль</button>
  </div>
</nav>

<div class="screen active" id="screen-landing">
  <div class="landing">
    <div class="landing-grid"></div>
    <div class="landing-badge">бета — всё бесплатно</div>
    <h1 class="landing-title">WEB<br><span>HOOD</span></h1>
    <p class="landing-sub">Все ссылки в одном месте.</p>
    <div class="landing-actions">
      <button class="btn btn-accent" onclick="openModal('registerModal')">занять своё место</button>
      <button class="btn btn-ghost" onclick="showScreen('explore')">смотреть профили</button>
    </div>
    <div class="landing-stats" id="landingStats">
      <div class="stat-item"><div class="stat-num" id="statUsers">0</div><div class="stat-label">профилей</div></div>
      <div class="stat-item"><div class="stat-num" id="statLinks">0</div><div class="stat-label">ссылок</div></div>
      <div class="stat-item"><div class="stat-num" id="statComments">0</div><div class="stat-label">комментов</div></div>
      <div class="stat-item"><div class="stat-num" id="statOnline" style="color:var(--accent)">0</div><div class="stat-label">онлайн</div></div>
    </div>
  </div>
</div>

<div class="screen" id="screen-explore">
  <div style="padding: 100px 48px 60px; max-width: 1000px; margin: 0 auto;">
    <div class="section-header">
      <h2 class="section-title">EXPLORE</h2>
      <p class="section-desc">все профили на платформе</p>
    </div>
    <div class="explore-grid" id="exploreGrid"></div>
  </div>
</div>

<div class="screen" id="screen-dashboard">
  <div class="dashboard">
    <aside class="sidebar">
      <div class="sidebar-section">
        <div class="sidebar-label">редактор</div>
        <button class="sidebar-btn active" onclick="switchTab('profile')" id="tab-profile">
          <span class="icon">◆</span> Профиль
        </button>
        <button class="sidebar-btn" onclick="switchTab('links')" id="tab-links">
          <span class="icon">◈</span> Ссылки
        </button>
        <button class="sidebar-btn" onclick="switchTab('appearance')" id="tab-appearance">
          <span class="icon">◉</span> Внешний вид
        </button>
        <button class="sidebar-btn" onclick="switchTab('music')" id="tab-music">
          <span class="icon">◎</span> Музыка
        </button>
        <button class="sidebar-btn" onclick="switchTab('themes')" id="tab-themes">
          <span class="icon">◐</span> Темы
        </button>
      </div>
      <div class="sidebar-section">
        <div class="sidebar-label">действия</div>
        <button class="sidebar-btn" onclick="previewProfile()">
          <span class="icon">→</span> Посмотреть
        </button>
        <button class="sidebar-btn" onclick="logout()">
          <span class="icon">×</span> Выйти
        </button>
      </div>
    </aside>
    <main class="content-area">

      <div id="tabContent-profile">
        <div class="section-header">
          <h2 class="section-title">ПРОФИЛЬ</h2>
          <p class="section-desc">основная информация о тебе</p>
        </div>
        <div class="panel">
          <div class="panel-title">аватар</div>
          <div class="avatar-upload-area">
            <div class="avatar-preview" onclick="document.getElementById('avatarInput').click()" id="dashAvatar">
              <span>+</span>
            </div>
            <div class="avatar-info">
              <p>Нажми на круг, чтобы загрузить фото. Рекомендуем квадратное изображение.</p>
              <button class="btn btn-ghost btn-sm" onclick="document.getElementById('avatarInput').click()">загрузить фото</button>
              <input type="file" id="avatarInput" accept="image/*" style="display:none" onchange="handleAvatarUpload(event)">
            </div>
          </div>
        </div>
        <div class="panel">
          <div class="panel-title">информация</div>
          <div class="form-group">
            <label class="form-label">отображаемое имя</label>
            <input class="form-input" id="displayName" placeholder="Как тебя звать?" oninput="saveProfile()">
          </div>
          <div class="form-group">
            <label class="form-label">статус / биография</label>
            <textarea class="form-input" id="userBio" placeholder="Пару слов о себе..." oninput="saveProfile()"></textarea>
          </div>
        </div>
        <button class="btn btn-accent" onclick="saveProfile()">сохранить изменения</button>
      </div>

      <div id="tabContent-links" style="display:none">
        <div class="section-header">
          <h2 class="section-title">ССЫЛКИ</h2>
          <p class="section-desc">добавь свои соцсети и сайты</p>
        </div>
        <div class="panel">
          <div class="panel-title">мои ссылки</div>
          <div class="links-list" id="linksList"></div>
          <button class="add-link-btn" onclick="addLink()">+ добавить ссылку</button>
        </div>
        <button class="btn btn-accent" onclick="saveProfile()" style="margin-top:8px">сохранить</button>
      </div>

      <div id="tabContent-appearance" style="display:none">
        <div class="section-header">
          <h2 class="section-title">ВНЕШНИЙ ВИД</h2>
          <p class="section-desc">настрой фон своей страницы</p>
        </div>
        <div class="panel">
          <div class="panel-title">фон страницы</div>
          <div class="bg-options" id="bgOptions">
            <div class="bg-option selected" data-bg="default" style="background: #080808; display:flex;align-items:center;justify-content:center;font-size:9px;color:#444;font-family:monospace;letter-spacing:0.05em;">DEFAULT</div>
            <div class="bg-option" data-bg="gradient1" style="background: linear-gradient(135deg, #0a0a1a, #1a0a0a);"></div>
            <div class="bg-option" data-bg="gradient2" style="background: linear-gradient(135deg, #050510, #0a1a0a);"></div>
            <div class="bg-option" data-bg="gradient3" style="background: linear-gradient(135deg, #0f0f0f, #1a1000);"></div>
            <div class="bg-option" data-bg="gradient4" style="background: radial-gradient(ellipse at top, #1a1a2e, #000);"></div>
            <div class="bg-option" data-bg="gradient5" style="background: radial-gradient(ellipse at top, #1a0a0a, #000);"></div>
            <div class="bg-option" data-bg="dots" style="background: #080808; background-image: radial-gradient(#1e1e1e 1px, transparent 1px); background-size: 16px 16px;"></div>
            <div class="bg-option" data-bg="grid" style="background: #080808; background-image: linear-gradient(#141414 1px, transparent 1px), linear-gradient(90deg, #141414 1px, transparent 1px); background-size: 20px 20px;"></div>
          </div>
          <div class="bg-custom-row" style="margin-top: 20px;">
            <label class="form-label" style="margin:0">или загрузи своё фото:</label>
            <button class="btn btn-ghost btn-sm" onclick="document.getElementById('bgInput').click()">загрузить</button>
            <input type="file" id="bgInput" accept="image/*" style="display:none" onchange="handleBgUpload(event)">
          </div>
        </div>
        <div class="panel">
          <div class="panel-title">акцентный цвет</div>
          <div style="display:flex;align-items:center;gap:14px;">
            <input type="color" class="color-input" id="accentColor" value="#c8ff00" onchange="previewAccent(this.value)">
            <span style="font-size:13px;color:var(--text-muted)">выбери цвет акцентов на твоей странице</span>
          </div>
        </div>
        <div class="panel">
          <div class="panel-title">стиль ника в комментариях</div>
          <div style="font-size:12px;color:var(--text-muted);margin-bottom:14px">когда ты комментируешь «от своего имени», ник будет показан в этом стиле</div>
          <div class="nick-font-grid" id="nickFontGrid">
            <div class="nick-font-option selected" data-font="JetBrains Mono" style="font-family:'JetBrains Mono',monospace">Mono</div>
            <div class="nick-font-option" data-font="Bebas Neue" style="font-family:'Bebas Neue',sans-serif;font-size:16px">Bebas</div>
            <div class="nick-font-option" data-font="Playfair Display" style="font-family:'Playfair Display',serif">Playfair</div>
            <div class="nick-font-option" data-font="Space Grotesk" style="font-family:'Space Grotesk',sans-serif">Grotesk</div>
            <div class="nick-font-option" data-font="Raleway" style="font-family:'Raleway',sans-serif">Raleway</div>
            <div class="nick-font-option" data-font="Courier Prime" style="font-family:'Courier Prime',monospace">Courier</div>
            <div class="nick-font-option" data-font="Unbounded" style="font-family:'Unbounded',sans-serif;font-size:11px">Unbounded</div>
            <div class="nick-font-option" data-font="Caveat" style="font-family:'Caveat',cursive;font-size:16px">Caveat</div>
          </div>
          <div class="nick-color-row">
            <label class="form-label" style="margin:0">цвет ника:</label>
            <input type="color" class="color-input" id="nickColor" value="#c8ff00" onchange="saveNickStyle()">
            <span style="font-size:12px;color:var(--text-muted)">предпросмотр:</span>
            <span id="nickPreview" style="font-size:14px;color:#c8ff00;font-family:'JetBrains Mono',monospace">@твойник</span>
          </div>
        </div>
        <button class="btn btn-accent" onclick="saveProfile()" style="margin-top:8px">сохранить</button>
      </div>

      <div id="tabContent-music" style="display:none">
        <div class="section-header">
          <h2 class="section-title">МУЗЫКА</h2>
          <p class="section-desc">один трек, который будет играть на твоей странице</p>
        </div>
        <div class="panel">
          <div class="panel-title">аудио файл</div>
          <div class="music-drop" id="musicDrop" onclick="document.getElementById('musicInput').click()">
            <div class="music-drop-icon" id="musicDropIcon">◎</div>
            <div class="music-drop-text" id="musicDropText">нажми или перетащи mp3 / wav / ogg файл</div>
            <div class="music-drop-name" id="musicFileName"></div>
          </div>
          <input type="file" id="musicInput" accept="audio/*" style="display:none" onchange="handleMusicUpload(event)">
          <div style="margin-top:16px">
            <label class="form-label">отображаемое название трека</label>
            <input class="form-input" id="musicDisplayName" placeholder="Артист — Название" oninput="saveMusicDisplayName()">
            <div class="form-note">// это имя будет показано в плеере на твоей странице</div>
          </div>
          <div style="margin-top:14px;display:flex;gap:10px;">
            <button class="btn btn-danger btn-sm" onclick="removeMusic()" id="removeMusicBtn" style="display:none">удалить трек</button>
          </div>
        </div>
        <button class="btn btn-accent" onclick="saveProfile()" style="margin-top:8px">сохранить</button>
      </div>

      <div id="tabContent-themes" style="display:none">
        <div class="section-header">
          <h2 class="section-title">ТЕМЫ</h2>
          <p class="section-desc">экспортируй своё оформление, делись и импортируй чужие</p>
        </div>
        <div class="panel">
          <div class="panel-title">// экспорт текущей темы</div>
          <p style="font-size:13px;color:var(--text-muted);margin-bottom:16px">сохраняет цвета, шрифт ника, фон, ссылки — всё кроме личных данных и файлов</p>
          <div style="display:flex;gap:10px;margin-bottom:16px;flex-wrap:wrap">
            <input class="form-input" id="themeExportName" placeholder="название темы (напр. «dark neon»)" style="flex:1;min-width:180px">
          </div>
          <div style="display:flex;gap:10px">
            <button class="btn btn-accent btn-sm" onclick="exportTheme()">скачать .hood файл</button>
            <button class="btn btn-ghost btn-sm" onclick="copyThemeJson()">скопировать JSON</button>
          </div>
          <div id="themeJsonOut" style="display:none;margin-top:14px">
            <label class="form-label">JSON темы</label>
            <textarea class="theme-json-area" id="themeJsonText" readonly onclick="this.select()"></textarea>
            <div class="form-note">// нажми на текст чтобы выделить всё</div>
          </div>
        </div>
        <div class="panel" style="margin-top:0">
          <div class="panel-title">// импорт темы</div>
          <div class="theme-import-drop" id="themeDropZone"
            onclick="document.getElementById('themeFileInput').click()"
            ondragover="event.preventDefault();this.classList.add('drag')"
            ondragleave="this.classList.remove('drag')"
            ondrop="handleThemeDrop(event)">
            <div class="theme-import-drop-icon">◐</div>
            <div class="theme-import-drop-text">нажми или перетащи .hood / .json файл</div>
          </div>
          <input type="file" id="themeFileInput" accept=".hood,.json" style="display:none" onchange="handleThemeFile(event)">
          <div style="margin-top:12px">
            <label class="form-label">или вставь JSON вручную</label>
            <textarea class="theme-json-area" id="themeJsonIn" placeholder='{"themeName":"...","accentColor":"#c8ff00",...}'></textarea>
          </div>
          <div style="display:flex;gap:10px;margin-top:12px">
            <button class="btn btn-accent btn-sm" onclick="importThemeFromText()">применить тему</button>
            <button class="btn btn-ghost btn-sm" onclick="document.getElementById('themeJsonIn').value=''">очистить</button>
          </div>
        </div>
        <div class="panel" style="margin-top:0">
          <div class="panel-title">// сохранённые темы</div>
          <div id="savedThemesList">
            <div style="font-size:12px;color:var(--text-dim);font-family:'JetBrains Mono',monospace">нет сохранённых тем</div>
          </div>
          <button class="btn btn-ghost btn-sm" style="margin-top:14px" onclick="renderSavedThemes()">↺ обновить</button>
        </div>
      </div>

    </main>
  </div>

  <nav class="mobile-tab-bar" id="mobileTabBar">
    <button class="mobile-tab-btn active" id="mtab-profile" onclick="switchTab('profile');setMobileTab('profile')">
      <span class="mobile-tab-icon">◆</span><span>Профиль</span>
    </button>
    <button class="mobile-tab-btn" id="mtab-links" onclick="switchTab('links');setMobileTab('links')">
      <span class="mobile-tab-icon">◈</span><span>Ссылки</span>
    </button>
    <button class="mobile-tab-btn" id="mtab-appearance" onclick="switchTab('appearance');setMobileTab('appearance')">
      <span class="mobile-tab-icon">◉</span><span>Вид</span>
    </button>
    <button class="mobile-tab-btn" id="mtab-music" onclick="switchTab('music');setMobileTab('music')">
      <span class="mobile-tab-icon">◎</span><span>Музыка</span>
    </button>
    <button class="mobile-tab-btn" id="mtab-themes" onclick="switchTab('themes');setMobileTab('themes')">
      <span class="mobile-tab-icon">◐</span><span>Темы</span>
    </button>
    <button class="mobile-tab-btn" id="mtab-view" onclick="previewProfile()">
      <span class="mobile-tab-icon">→</span><span>Смотреть</span>
    </button>
  </nav>
</div>

<div class="screen" id="screen-profile">
  <div class="profile-bg" id="profileBg"></div>
  <button class="btn btn-ghost btn-sm profile-back" onclick="goBack()">← назад</button>
  <div class="profile-view-wrap">
    <div class="profile-container">
      <div class="profile-header">
        <div class="profile-avatar-ring">
          <div class="profile-avatar-img" id="profileAvatar"></div>
        </div>
        <h1 class="profile-name" id="profileName"></h1>
        <div style="display:flex;align-items:center;justify-content:center;gap:5px;margin-bottom:12px">
          <span class="profile-handle" id="profileHandle"></span>
          <span id="profileVerified" style="display:none" class="verified-check">✓</span>
        </div>
        <div id="profileOnlineRow" style="display:none" class="profile-online-row">
          <span class="online-dot"></span><span>онлайн</span>
        </div>
        <div class="profile-views" id="profileViews"></div>
        <div class="profile-badges" id="profileBadges"></div>
        <p class="profile-bio" id="profileBio"></p>
      </div>
      <div id="profileMusicPlayer" style="display:none"></div>
      <div class="profile-links" id="profileLinks"></div>
      <div class="reactions-bar" id="reactionsBar">
        <button class="reaction-btn" id="likeBtn" onclick="react('like')">
          <span>+</span><span class="reaction-count" id="likeCount">0</span>
        </button>
        <button class="reaction-btn" id="dislikeBtn" onclick="react('dislike')">
          <span>−</span><span class="reaction-count" id="dislikeCount">0</span>
        </button>
      </div>
      <div class="comments-section">
        <div class="comments-header">
          <span>комментарии</span>
          <span class="comments-count" id="commentsCount">0</span>
        </div>
        <div class="comments-list" id="commentsList">
          <div class="empty-state">
            <div class="empty-state-icon" style="font-size:24px">◌</div>
            <div class="empty-state-text">пока нет комментариев.<br>будь первым.</div>
          </div>
        </div>
        <div class="comment-form">
          <div id="asSelfToggleWrap" style="display:none">
            <label class="as-self-toggle">
              <input type="checkbox" id="asSelfCheck" onchange="toggleAsSelf()">
              <label for="asSelfCheck" style="pointer-events:none">написать от своего имени</label>
              <span class="as-self-badge" id="asSelfUser"></span>
            </label>
          </div>
          <div class="comment-form-row" id="commentFormRow">
            <div id="commentNickWrap">
              <label class="form-label">твой ник *</label>
              <input class="form-input" id="commentNick" placeholder="anonymous">
            </div>
            <div>
              <label class="form-label">сообщение *</label>
              <input class="form-input" id="commentText" placeholder="сообщение">
            </div>
          </div>
          <div class="comment-form-actions">
            <button class="btn btn-accent btn-sm" onclick="postComment()">отправить</button>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Модальные окна -->
<div class="modal-overlay" id="loginModal" onclick="closeModalOutside(event,'loginModal')">
  <div class="modal">
    <button class="modal-close" onclick="closeModal('loginModal')">×</button>
    <h2 class="modal-title">ВОЙТИ</h2>
    <p class="modal-sub">возвращайся, мы тебя ждали.</p>
    <div class="form-group">
      <label class="form-label">имя пользователя</label>
      <input class="form-input" id="loginUsername" placeholder="username" autocomplete="username">
    </div>
    <div class="form-group">
      <label class="form-label">пароль</label>
      <input class="form-input" type="password" id="loginPassword" placeholder="••••••••" autocomplete="current-password">
    </div>
    <div class="form-error" id="loginError"></div>
    <button class="btn btn-accent" style="width:100%;margin-top:8px" onclick="login()">войти</button>
    <div class="modal-switch">нет аккаунта? <a onclick="switchModal('loginModal','registerModal')">создать</a></div>
  </div>
</div>

<div class="modal-overlay" id="registerModal" onclick="closeModalOutside(event,'registerModal')">
  <div class="modal">
    <button class="modal-close" onclick="closeModal('registerModal')">×</button>
    <h2 class="modal-title">СОЗДАТЬ</h2>
    <p class="modal-sub">займи своё место в сети.</p>
    <div class="form-group">
      <label class="form-label">имя пользователя</label>
      <input class="form-input" id="regUsername" placeholder="only_latin_letters" autocomplete="username">
      <div class="form-note">// только латиница, цифры, _  — это будет твой URL</div>
    </div>
    <div class="form-group">
      <label class="form-label">отображаемое имя</label>
      <input class="form-input" id="regDisplayName" placeholder="Как тебя зовут?" autocomplete="name">
    </div>
    <div class="form-group">
      <label class="form-label">пароль</label>
      <input class="form-input" type="password" id="regPassword" placeholder="минимум 6 символов" autocomplete="new-password">
    </div>
    <div class="form-error" id="regError"></div>
    <button class="btn btn-accent" style="width:100%;margin-top:8px" onclick="register()">создать профиль</button>
    <div class="modal-switch">уже есть аккаунт? <a onclick="switchModal('registerModal','loginModal')">войти</a></div>
  </div>
</div>

<!-- Админка -->
<div class="admin-overlay" id="adminOverlay">
  <div class="admin-panel">
    <div class="admin-header">
      <div>
        <div class="admin-title">ADMIN PANEL</div>
      </div>
      <div style="display:flex;align-items:center;gap:12px">
        <span class="admin-badge">ROOT ACCESS</span>
        <button class="btn btn-ghost btn-sm" onclick="closeAdmin()">закрыть ×</button>
      </div>
    </div>
    <div class="admin-body" id="adminBody">
      <div class="admin-tabs">
        <button class="admin-tab-btn active" onclick="switchAdminTab('users')">// профили</button>
        <button class="admin-tab-btn" onclick="switchAdminTab('badges')">// бейджики</button>
        <button class="admin-tab-btn" onclick="switchAdminTab('stats')">// статистика</button>
      </div>
      <div class="admin-tab-pane active" id="adminTabUsers">
        <div style="font-size:13px;color:var(--text-muted);margin-bottom:24px;font-family:'JetBrains Mono',monospace">// нажми на профиль чтобы раскрыть</div>
        <div id="adminUsersList"></div>
      </div>
      <div class="admin-tab-pane" id="adminTabBadges">
        <div style="font-size:13px;color:var(--text-muted);margin-bottom:20px;font-family:'JetBrains Mono',monospace">// создай бейджик и выдай пользователю</div>
        <div style="background:var(--bg);border:1px solid var(--border);border-radius:var(--radius-lg);padding:20px;margin-bottom:24px">
          <div class="admin-section-title">// новый бейджик</div>
          <div style="display:grid;grid-template-columns:1fr 1fr;gap:10px;margin-bottom:12px">
            <div>
              <label class="form-label">название</label>
              <input class="form-input" id="newBadgeName" placeholder="Например: Ранний пользователь">
            </div>
            <div>
              <label class="form-label">эмодзи / символ (если нет фото)</label>
              <input class="form-input" id="newBadgeEmoji" placeholder="⭐ или ★ или VIP" maxlength="4">
            </div>
          </div>
          <div style="margin-bottom:12px">
            <label class="form-label">фото бейджика (необязательно)</label>
            <div style="display:flex;gap:10px;align-items:center">
              <button class="btn btn-ghost btn-sm" onclick="document.getElementById('badgeImgInput').click()">загрузить фото</button>
              <span id="badgeImgName" style="font-size:12px;color:var(--text-muted);font-family:'JetBrains Mono',monospace"></span>
              <input type="file" id="badgeImgInput" accept="image/*" style="display:none" onchange="handleBadgeImgUpload(event)">
            </div>
          </div>
          <div style="margin-bottom:16px">
            <label class="form-label">предпросмотр</label>
            <span class="badge-admin-preview" id="newBadgePreview">◈ новый бейджик</span>
          </div>
          <button class="btn btn-accent btn-sm" onclick="createBadge()">создать бейджик</button>
        </div>
        <div>
          <div class="admin-section-title">// все бейджики</div>
          <div class="badge-list-admin" id="adminBadgeList">
            <div style="font-size:12px;color:var(--text-dim);font-family:'JetBrains Mono',monospace">нет бейджиков</div>
          </div>
        </div>
      </div>
      <div class="admin-tab-pane" id="adminTabStats">
        <div id="adminStatsContent"></div>
      </div>
    </div>
  </div>
</div>

<div class="toast-container" id="toastContainer"></div>
<audio id="audioPlayer" loop></audio>

</body>
</html>
